<header class="site-header">
    <div class="header-container h-card">
        <div class="site-branding">
            <div class="site-info">
                {{ if eq .Type "post" }}
                <a href="/" class="back-button" aria-label="Go back" onclick="if(document.referrer && document.referrer.includes(location.hostname) && history.length > 1){event.preventDefault(); history.back();}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                    <span>Back</span>
                </a>
                {{ else }}
                <h1 class="site-title">
                    <a href="/" class="u-url" rel="home">
                        <img src="/images/logo.svg" alt="{{ .Site.Title }} logo" class="title-avatar u-photo" width="36" height="36">
                        <span class="p-name">{{ .Site.Title }}</span>
                    </a>
                </h1>
                {{ end }}
            </div>
        </div>
        
        <nav class="site-navigation" aria-label="Main navigation">
            <!-- CSS-only mobile menu toggle using checkbox -->
            <input type="checkbox" id="mobile-menu-toggle" class="menu-toggle-input" aria-hidden="true">
            <label for="mobile-menu-toggle" class="menu-toggle" aria-label="Open main navigation menu">
                <span class="menu-toggle-text">{{ T "Menu" }}</span>
                <span class="hamburger" aria-hidden="true">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </label>

            <!-- JavaScript fallback button (hidden by default) -->
            <button class="menu-toggle js-menu-toggle" aria-controls="primary-menu" aria-expanded="false" aria-label="Open main navigation menu" type="button" style="display: none;">
                <span class="menu-toggle-text">{{ T "Menu" }}</span>
                <span class="hamburger" aria-hidden="true">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </button>

            <div class="menu-backdrop" id="menu-backdrop"></div>
            <div class="primary-menu" id="primary-menu" role="menu" aria-label="Navigation menu">
                <div class="menu-content">
                    <ul class="nav-menu">
                        {{ range .Site.Menus.main }}
                        <li class="nav-item" role="none">
                            <a href="{{ .URL }}" class="nav-link {{ .Name }}{{ if or (eq $.RelPermalink .URL) (and (ne .URL "/") (hasPrefix $.RelPermalink .URL)) (and (eq (lower .Name) "work") (eq $.RelPermalink "/")) }} active{{ end }}" role="menuitem">
                                {{ if eq (lower .Name) "search" }}
                                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
                                <span class="icon-label">Search</span>
                                {{ else }}
                                {{ .Name }}
                                {{ end }}
                            </a>
                        </li>
                        {{ end }}
                        <li class="nav-divider" aria-hidden="true"></li>
                        <li class="nav-item nav-item-toggle" role="none">
                            <a href="#" id="theme-toggle" class="nav-link theme-toggle-link" role="menuitem" aria-label="Toggle dark mode">
                                <span class="toggle-prefix">Appearance</span>
                                <svg class="toggle-chevron" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                                <svg class="toggle-icon sun-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                                <svg class="toggle-icon moon-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                                <span class="icon-label toggle-label-light">Light</span>
                                <span class="icon-label toggle-label-dark">Dark</span>
                            </a>
                        </li>
                    </ul>
                    
                    {{ $socialLinks := slice }}
                    {{ if .Site.Params.social_microblog }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_microblog "icon" "ph ph-broadcast" "label" "Micro.blog") }}{{ end }}
                    {{ if .Site.Params.social_mastodon }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_mastodon "icon" "ph ph-mastodon-logo" "label" "Mastodon") }}{{ end }}
                    {{ if .Site.Params.social_x }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_x "icon" "ph ph-x-logo" "label" "X") }}{{ end }}
                    {{ if .Site.Params.social_instagram }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_instagram "icon" "ph ph-instagram-logo" "label" "Instagram") }}{{ end }}
                    {{ if .Site.Params.social_facebook }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_facebook "icon" "ph ph-facebook-logo" "label" "Facebook") }}{{ end }}
                    {{ if .Site.Params.social_tiktok }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_tiktok "icon" "ph ph-tiktok-logo" "label" "TikTok") }}{{ end }}
                    {{ if .Site.Params.social_bluesky }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_bluesky "icon" "ph ph-butterfly" "label" "Bluesky") }}{{ end }}
                    {{ if .Site.Params.social_nostr }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_nostr "icon" "ph ph-feather" "label" "Nostr") }}{{ end }}
                    {{ if .Site.Params.social_medium }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_medium "icon" "ph ph-medium-logo" "label" "Medium") }}{{ end }}
                    {{ if .Site.Params.social_threads }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_threads "icon" "ph ph-threads-logo" "label" "Threads") }}{{ end }}
                    {{ if .Site.Params.social_pinterest }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_pinterest "icon" "ph ph-pinterest-logo" "label" "Pinterest") }}{{ end }}
                    {{ if .Site.Params.social_youtube }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_youtube "icon" "ph ph-youtube-logo" "label" "YouTube") }}{{ end }}
                    {{ if .Site.Params.social_linkedin }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_linkedin "icon" "ph ph-linkedin-logo" "label" "LinkedIn") }}{{ end }}
                    {{ if .Site.Params.social_snapchat }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_snapchat "icon" "ph ph-snapchat-logo" "label" "Snapchat") }}{{ end }}
                    {{ if .Site.Params.social_tumblr }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_tumblr "icon" "ph ph-globe" "label" "Tumblr") }}{{ end }}
                    {{ if .Site.Params.social_flickr }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_flickr "icon" "ph ph-camera" "label" "Flickr") }}{{ end }}
                    {{ if .Site.Params.social_github }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_github "icon" "ph ph-github-logo" "label" "GitHub") }}{{ end }}
                    {{ if .Site.Params.social_gitlab }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_gitlab "icon" "ph ph-gitlab-logo" "label" "GitLab") }}{{ end }}
                    {{ if .Site.Params.social_reddit }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_reddit "icon" "ph ph-reddit-logo" "label" "Reddit") }}{{ end }}
                    {{ if .Site.Params.social_discord }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_discord "icon" "ph ph-discord-logo" "label" "Discord") }}{{ end }}
                    {{ if .Site.Params.social_amazon }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_amazon "icon" "ph ph-amazon-logo" "label" "Amazon") }}{{ end }}
                    {{ if .Site.Params.social_patreon }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_patreon "icon" "ph ph-patreon-logo" "label" "Patreon") }}{{ end }}
                    {{ if .Site.Params.social_buymeacoffee }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_buymeacoffee "icon" "ph ph-coffee" "label" "Buy Me a Coffee") }}{{ end }}
                    {{ if .Site.Params.social_kofi }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_kofi "icon" "ph ph-coffee" "label" "Ko-fi") }}{{ end }}
                    {{ if .Site.Params.social_paypal }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_paypal "icon" "ph ph-paypal-logo" "label" "PayPal") }}{{ end }}
                    {{ if .Site.Params.social_donate }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_donate "icon" "ph ph-heart" "label" "Support") }}{{ end }}
                    {{ if .Site.Params.social_contact }}{{ $socialLinks = $socialLinks | append (dict "url" .Site.Params.social_contact "icon" "ph ph-envelope" "label" "Contact") }}{{ end }}
                    
                    {{ if gt (len $socialLinks) 0 }}
                    <div class="social-icons" role="group" aria-label="Social media links">
                        {{ range $socialLinks }}
                        <a href="{{ .url }}" class="social-link u-url" aria-label="{{ .label }}" target="_blank" rel="noopener noreferrer me">
                            <i class="{{ .icon }}" aria-hidden="true"></i>
                        </a>
                        {{ end }}
                    </div>
                    {{ end }}
                </div>
            </div>
        </nav>
    </div>
</header>