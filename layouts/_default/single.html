{{ define "main" }}
{{/* Redirect hidden pages to homepage */}}
{{ $hiddenPages := slice "/intro/" "/footer/" "/social/" "/work/" }}
{{ if in $hiddenPages .RelPermalink }}
<script>window.location.replace('/');</script>
<noscript><meta http-equiv="refresh" content="0;url=/"></noscript>

{{/* Logs page - show logs listing */}}
{{ else if eq .RelPermalink "/logs/" }}
<div class="page-content">
    <header class="page-header">
        <h1 class="page-title">{{ .Title }}</h1>
    </header>

    {{ $logs := where .Site.RegularPages "Params.categories" "intersect" (slice "logs") }}
    {{ if $logs }}
    <section class="posts-list" aria-label="Log posts">
        {{ range $logs }}
        <article class="post-item h-entry">
            <header class="post-header">
                {{ if .Title }}
                <h2 class="post-title p-name">
                    <a href="{{ .Permalink }}">{{ .Title }}</a>
                </h2>
                {{ end }}

                <div class="post-meta">
                    <a href="{{ .Permalink }}" class="post-date-link u-url">
                        <time class="dt-published" datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
                            {{ .Date | time.Format ":date_long" }}
                        </time>
                    </a>
                </div>
            </header>

            <div class="post-content e-content">
                {{ .Content }}
            </div>
        </article>
        {{ end }}
    </section>
    {{ else }}
    <div class="empty-list">
        <p>No logs found.</p>
    </div>
    {{ end }}
</div>

{{/* Blog page - show blog listing */}}
{{ else if eq .RelPermalink "/blog/" }}
<div class="blog-page">
    <header class="page-header">
        <h1 class="page-title">{{ .Title }}</h1>
        {{ with .Content }}
        <div class="page-description">{{ . }}</div>
        {{ end }}
    </header>

    <section class="blog-list">
        {{/* Try both Section and Type to find posts */}}
        {{ $allPosts := .Site.RegularPages }}
        {{ $blogPosts := slice }}
        {{ range $allPosts }}
            {{ $post := . }}
            {{ range .Params.categories }}
                {{ if eq (. | lower) "blogs" }}
                    {{ $blogPosts = $blogPosts | append $post }}
                {{ end }}
            {{ end }}
        {{ end }}

        {{ if gt (len $blogPosts) 0 }}
            {{ range $blogPosts }}
            {{ $post := . }}
            <article class="blog-item">
                <div class="blog-item-content">
                    <span class="blog-item-date">{{ .Date.Format "January 2, 2006" }}</span>
                    <h3 class="blog-item-title">
                        <a href="{{ .Permalink }}">{{ .Title | default "Untitled" }}</a>
                    </h3>
                    <a href="{{ .Permalink }}" class="blog-item-link">Read <span>â†’</span></a>
                </div>
                {{ with .Params.photos }}
                <a href="{{ $post.Permalink }}" class="blog-item-image">
                    <img src="{{ index . 0 }}" alt="{{ $post.Title }}" loading="lazy">
                </a>
                {{ end }}
            </article>
            {{ end }}
        {{ else }}
            <p class="no-posts">No blog posts found.</p>
        {{ end }}
    </section>
</div>

{{ else }}
<article class="page-single">
    {{ if .Title }}
    <header class="page-header">
        <h1 class="page-title">{{ .Title }}</h1>
    </header>
    {{ end }}

    {{ if templates.Exists "partials/microhook-before-page-content.html" }}
    {{ partial "microhook-before-page-content.html" . }}
    {{ end }}

    <div class="post-content">
        {{ .Content }}
    </div>

    {{ if templates.Exists "partials/microhook-after-page-content.html" }}
    {{ partial "microhook-after-page-content.html" . }}
    {{ end }}

</article>
{{ end }}
{{ end }}